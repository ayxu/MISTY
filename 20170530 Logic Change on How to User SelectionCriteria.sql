select g.RPOSCode, g.InvoiceDate, sum(g.LocalCurrencyAmount), g.SC01160from (select  P.YearPeriod,  N'' AS CalendarDay,  N'' AS DataEntryYearPeriod,  P.Version,  P.ReportingUnit,  P.UpperHierarchy,  P.PartnerReportingUnit,  P.PartnerUpperHierarchy,  N'' AS Shares,  P.RPOSCode,  P.SC01160, P.InvoiceDate, N'' AS MovementType,  P.MaterialLocal,  P.MaterialGlobal,  P.IntlArticleGPH,  N'' AS [Function],  P.CountryOfDestination,  P.CustomerLocal,  N'' AS AuditID,  P.LocalCurrency,    SUM(CONVERT(NUMERIC(27,2),LocalCurrencyAmount)) AS LocalCurrencyAmount,  '' AS TransactionCurrency,  '' AS TransactionCurrencyAmount, --FSL 20111205 BEGIN: Correction on error "Error converting data type nvarchar to numeric" /*  REPLACE(CONVERT(NVARCHAR,SUM(CONVERT(NUMERIC(27,6),P.QuantityPC))),N'.',N',') AS QuantityPC,  REPLACE(CONVERT(NVARCHAR,SUM(P.QuantityAltUnit)),N'.',N',') AS QuantityAltUnit,  CASE WHEN SUM(P.QuantityLoose) = 0 THEN ''    ELSE REPLACE(CONVERT(NVARCHAR,SUM(P.QuantityLoose)),N'.',N',')  END AS QuantityLoose,  CASE WHEN SUM(P.QuantityLoose) = 0 THEN ''  ELSE P.QuantityUnit  END AS QuantityUnit */  SUM(CONVERT(NUMERIC(27,6),P.QuantityPC)) AS QuantityPC,  SUM(P.QuantityAltUnit) AS QuantityAltUnit,  SUM(P.QuantityLoose) AS QuantityLoose,  P.QuantityUnit AS QuantityUnit --FSL 20111205  END FROM  ( SELECT '2016' + N'.' +   '01' AS YearPeriod,   A.Version,   A.ReportingUnit,   A.UpperHierarchy,   A.PartnerReportingUnit,   A.PartnerUpperHierarchy,   Case when A.InvoiceDate >= convert(datetime, convert(varchar(10), E.DataValue,120)) then ISNULL(F.[DataValue], '3011110000') else B.RPOSCodeReplacement end AS RPOSCode,   D.SC01160,  A.InvoiceDate,  A.MaterialLocal,   A.MaterialGlobal,   A.IntlArticleGPH,   A.CountryOfDestination,   A.CustomerLocal,   A.LocalCurrency,   LocalCurrencyAmount,   CASE WHEN A.RPOSCode IN ('5811100000', '5811210000')    THEN QuantityPC    ELSE 0   END QuantityPC,     CASE WHEN  A.RPOSCode not in('5811220000', '5811240000') THEN dbo.GS_DB_FUN_CheckNeedAltQtyUnit(A.CompanyCode, A.UpperHierarchy, B.RPOSCodeReplacement, A.QuantityAltUnit) ELSE 0 END AS QuantityAltUnit,   QuantityLoose, --FSL 20111205 BEGIN: Correction on error "Error converting data type nvarchar to numeric" --                                      QuantityUnit       CASE WHEN QuantityLoose = 0 THEN ''              ELSE QuantityUnit         END QuantityUnit --FSL 20111205 END  FROM GS_DB_TBL_ATR_GaussFinanceClusterI_102516 A  INNER JOIN (SELECT RPOSCode, RPOSCodeReplacement                                                 FROM ReportingPositions                                                 WHERE RPOSCodeReplacement = '3011110000'                                                   AND IsSperI = 1) B   ON A.RPOSCode = B.RPOSCode  INNER JOIN Companies C   ON A.CompanyCode = C.CompanyCode  INNER JOIN ScalaHU_1025..SC019100 D   ON A.MaterialLocal = D.SC01001 LEFT OUTER JOIN SelectionCriteria E --valid date   ON A.CompanyCode = E.CompanyCode and E.[Type] = 'IFRS15' LEFT OUTER JOIN SelectionCriteria F --RPOSCode   ON A.CompanyCode = F.CompanyCode and 'IFRS15-' + D.SC01160 = F.[Type]  WHERE C.CMGID = '1025'   AND A.InvoiceDate BETWEEN '2016/01/01' AND '2016/01/31'   --AND A.InvoiceDate >= convert(datetime, convert(varchar(10), E.DataValue,120))  AND C.IncludeInSperISTExtract = 1  ) P GROUP BY P.YearPeriod,  P.Version,  P.ReportingUnit,  P.UpperHierarchy,  P.PartnerReportingUnit,  P.PartnerUpperHierarchy,  P.RPOSCode, P.SC01160,  P.InvoiceDate, P.MaterialLocal,  P.MaterialGlobal,  P.IntlArticleGPH,  P.CountryOfDestination,  P.CustomerLocal,  P.LocalCurrency,    P.QuantityUnit  ) ggroup by g.RPOSCode, CONVERT(datetime, g.InvoiceDate), g.SC01160select RPOSCode, sum(LocalCurrencyAmount) from GS_DB_TBL_ATR_GaussFinanceClusterI_102516where InvoiceDate between '2016-01-01' and '2016-01-20'and RPOSCode like '%5811%'group by RPOSCode--select CONVERT(char(10), getdate(),112)--select case when CONVERT(datetime, '20160116') < getdate() then 'Yes' else 'No' end